<%= form_tag(create_tender_info_tenders_path, :html => { :multipart => true }) do |f| %> 
    <div class="text-center">
      <h1>ADD TENDER DETAILS</h1>
      <h3>
        Add the key tender details your subcontractors require.
      </h3>
    </div>
    <% if @errors.present? %>
        <div class="alert alert-danger open-sans-regular text-center" id="users_error" >
          <button type="button" class="close" data-dismiss="alert"></button>
          <h2 style="color:#e73d4a">
            Almost there, please complete the fields highlighted in red.
          </h2>

        </div>
    <% end %>



    <div class="col-md-12 ">
      <!-- BEGIN SAMPLE FORM PORTLET-->
      <!--<div class="portlet light bordered">-->

        <div class="form-body">
          <div class="form-group">

            <h4>TENDER ID</h4>
            <input maxlength="200" type="text" required="required" class="form-control tendercon_id" readonly="readonly" name="tendercon_id"  value="<%= @tender.present? ? @tender.tendercon_id : "#{(@user.tendercon_id)}-#{rand(1000...10000)}" %>" style="background-color: #F6F6F6;border-color: #F6F6F6"/> 

          </div>
        </div>


        <!--<div class="portlet-body form">
          <div class="form-body">
            <div class="form-group">
              <h4>TENDER ID</h4> 
              <input maxlength="200" type="text" required="required" class="form-control tendercon_id" readonly="readonly" name="tendercon_id"  value="<%#= @tender.present? ? @tender.tendercon_id : "#{(@user.tendercon_id)}-#{rand(1000...10000)}" %>" style="background-color: #F6F6F6;border-color: #F6F6F6"/> 
            </div> 
            &lt;!&ndash;<div class="form-group">
              <label class="control-label">Tender Title</label> 
              <input maxlength="300" type="text" name="title"  class="form-control title" value="<%#= @tender.present? ? @tender.title : nil  %>"/> 
              <%# if @title_error.present? %>
                  <i style="color:red"><%#= @title_error %></i>
              <%# end %>
            </div>&ndash;&gt;
          </div>
        </div>-->
      <!--</div>-->
    </div>
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-6">


              <div class="form-body">
                <div class="form-group">
                  <h4>TENDER TITLE</h4>

                  <% if @title_error.present? %>
                      <input maxlength="300" type="text" name="title"  class="form-control title" value="<%= @tender.present? ? @tender.title : nil  %>" style="background-color: #F6F6F6;border-color: #e73d4a"/> 
                  <% else %>
                      <input maxlength="300" type="text" name="title"  class="form-control title" value="<%= @tender.present? ? @tender.title : nil  %>" style="background-color: #F6F6F6;border-color: #F6F6F6"/> 
                  <% end %>
                </div>
              </div>

        </div>


        <div class="col-md-6">
          <div class="form-body">
            <div class="form-group">
              <h4>QUOTE DUE</h4>


              <% if @quote_due_error.present? %>
                  <div class="input-icon right margin-top-10">
                    <i class="fa fa-caret-down" aria-hidden="true"></i>
                    <input type="text" class="form-control  quote" name="quote" value="<%= @tender.present? ? @tender.tender_quote.present? ? @tender.tender_quote.quote_date : nil : nil %>" style="background-color: #F6F6F6;border-color: #e73d4a"> </div>
                 <!-- <input type="text" class="form-control input-xlarge quote" name="quote" value="<%#= @tender.present? ? @tender.tender_quote.present? ? @tender.tender_quote.quote_date : nil : nil %>" style="background-color: #F6F6F6;border-color: #e73d4a"/>-->
                  <div class="input-group date  form_meridian_datetime" data-date="2012-12-21T15:25:00Z" id="form_meridian_datetime">

                  </div>
              <% else %>
                  <div class="input-icon right margin-top-10">
                    <i class="fa fa-caret-down" aria-hidden="true"></i>
                    <input type="text" class="form-control  quote" name="quote" value="<%= @tender.present? ? @tender.tender_quote.present? ? @tender.tender_quote.quote_date : nil : nil %>" style="background-color: #F6F6F6;border-color: #F6F6F6"> </div>
                  <!--<input type="text" class="form-control input-xlarge quote" name="quote" value="<%#= @tender.present? ? @tender.tender_quote.present? ? @tender.tender_quote.quote_date : nil : nil %>" style="background-color: #F6F6F6;border-color: #F6F6F6"/>-->
                  <div class="input-group date  form_meridian_datetime" data-date="2012-12-21T15:25:00Z" id="form_meridian_datetime">

                  </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
     <!-- <div class="portlet light bordered">-->
      <div class="form-body">
            <div class="form-group">
              <h4>CLIENT(Optional)</h4>
              <input maxlength="200" type="text" name="client"  class="form-control client" value="<%= @tender.present? ? @tender.client : nil  %>" style="background-color: #F6F6F6;border-color: #F6F6F6"/> 
            </div>


            <div class="form-group">
              <h4>ARCHITECT(Optional)</h4>
              <input maxlength="200" type="text" name="architect"  class="form-control architect" value="<%= @tender.present? ? @tender.architect : nil  %>" style="background-color: #F6F6F6;border-color: #F6F6F6"/> 
            </div>
          </div>
      <!--</div>-->
    </div>

    <div class="col-md-6">
      <!--<div class="portlet light bordered">-->

          <div class="form-body">
            <div class="form-group">
              <h4>SECTOR</h4>

              <% if @sector_error.present? %>
                  <%= select_tag "categories",content_tag(:option,'None',:value=>'')+options_from_collection_for_select(@categories, 'id','name',@tender.present? ? @tender.category_id : nil),{:class=> 'form-control', :style=>"background-color: #F6F6F6;border-color: #e73d4a"} %> 
              <% else %>
                  <%= select_tag "categories",content_tag(:option,'None',:value=>'')+options_from_collection_for_select(@categories, 'id','name',@tender.present? ? @tender.category_id : nil),{:class=> 'form-control', :style=>"background-color: #F6F6F6;border-color: #F6F6F6"} %> 
              <% end %>
            </div>

            <div class="form-body">
              <div class="form-group">
                <h4>VALUE</h4>

                <% if @value_error.present? %>
                    <%= select_tag "values",content_tag(:option,'None',:value=>'')+options_from_collection_for_select(@values, 'id','range',@tender.present? ? @tender.tender_value_id : nil),{:class=> 'form-control', :style=>"background-color: #F6F6F6;border-color: #e73d4a"} %> 
                <% else %>
                    <%= select_tag "values",content_tag(:option,'None',:value=>'')+options_from_collection_for_select(@values, 'id','range',@tender.present? ? @tender.tender_value_id : nil),{:class=> 'form-control', :style=>"background-color: #F6F6F6;border-color: #F6F6F6"} %> 
                <% end %>
              </div>
            </div>
          </div>

      <!--</div>-->
    </div>

    <div class="col-md-12">
      <!--<div class="portlet light bordered">-->
        <div class="form-body">
            <div class="form-group">
              <h4>DESCRIPTION</h4>
              <%= text_area_tag('about_me',@tender.present? ? @tender.description.html_safe : nil,:cols => '109',:rows => '8',:class => 'form-control wysihtml5', :style => "background-color: #F6F6F6;border-color: #F6F6F6") %> 
            </div>
          </div>
        </div>
      <!--</div>-->
    </div>

    <div class="col-md-6">
      <div class="form-body">
        <div class="form-group">
          <h4>ADDRESS</h4>
          <input type="hidden" name="original_address" class="o_address">

          <% if @address_error.present? %>
              <input type="type" class="form-control address" id="address" value="<%= @tender.present? ? @tender.address : nil  %>" name="address" style="background-color: #F6F6F6;border-color: #e73d4a"> 
          <% else %>
              <input type="type" class="form-control address" id="address" value="<%= @tender.present? ? @tender.address : nil  %>" name="address" style="background-color: #F6F6F6;border-color: #F6F6F6"> 
          <% end %>
        </div>

        <div class="form-group">
          <h4>SUBURB</h4>
          <input type="text" class="form-control suburb" value="<%= @tender.present? ? @tender.suburb : nil  %>" name="suburb" id="suburb"  style="background-color: #F6F6F6;border-color: #F6F6F6" readonly="readonly">
        </div>

        <div class="form-group">
          <h4>STATE</h4>
          <input type="text" class="form-control state" name="state" id="state" value="<%= @tender.present? ? @tender.state : nil  %>"  style="background-color: #F6F6F6;border-color: #F6F6F6" readonly="readonly"> 
        </div>

        <div class="form-group">
          <h4>POSTCODE</h4>
          <input type="text" class="form-control postcode" name="postcode" id="postcode" value="<%= @tender.present? ? @tender.postcode : nil  %>"  style="background-color: #F6F6F6;border-color: #F6F6F6" readonly="readonly"> 
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="form-body">
        <div style="height: 20px"></div>
        <div class="form-group"></div>
        <div class="form-group">
          <div id="map" style="height:310px;width:480px;"></div> 
        </div>

      </div>

    </div>



    <div class="col-md-12">
      <h4 class="control-label">TENDER STATUS</h4> 
      <div class="form-body">
        <div class="col-md-6">

          <label><input type="radio" class="tendering form-control" name="tendering" value="1"><strong>Tendering</strong> - Your organization is still tendering for this project.</label> 
          <p class="tendering_text" style="display: none;color: red"><i>After this tender is published, you can changed the Tender's status form Tendering to Awarded on the Details tab</i></p> 
        </div>
        <div class="col-md-6">
          <label><input type="radio" name="tendering" class="tendering form-control" value="2"><strong>Awarded</strong> - Yor company has already won this project</label> 
          <p class="awarded_text" style="display: none;color: red"><i>After this tender is published, you CAN NOT revert this tender's status back to Tendering.</i></p> 
        </div>

      </div>
    </div>


    <div class="col-md-6"></div>
    <div class="col-md-6">
      <div class="form-actions text-center pull-right">
        <button type="submit" class="btn submit_info" style="color:#FFFFFF; background-color:#c0c0c0 ;border: 2px solid;border-radius: 8px !important;width: 175px !important;height: 35px !important;margin-right: -15px;">
          <h4 style="margin-top: -1px;">
            Next
          </h4>
        </button>
      </div>
    </div>
    <input type="hidden" name="tender_id" value="<%= params[:info_id] %>">

<% end %>


<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyA7B-_hoQVA07h-qSd3E-HXxyXnM9W4zC8&libraries=places&sensor=false"></script> 
<script>
  $(document).ready(function(){
    /*$('.timepicker-no-seconds').timepicker({
      autoclose: true,
      minuteStep: 5
    });*/



    $('#categories').change(function(){
      var val = $(this).val();
      if(parseInt(val) > 0){
        //activate_info_btn()
      }
    });

    $('#values').change(function(){
      var val = $(this).val();

      if(parseInt(val) > 0){
        //activate_info_btn();
      }
    });

    /*$('.quote_description').keyup(function(){
      var val = $(this).val();

      if(val.length > 0){
        //activate_info_btn();
      }

    });*/



    function activate_info_btn(){
      var title = $('.title').val();
      var sector = $('#categories').val();
      var address = $('.address').val();
      var suburb = $('.suburb').val();
      var state = $('.state').val();
      var postcode = $('.postcode').val();
      var quote = $('.quote').val();
      var values = $('#values').val();
      var due_desc = $('.quote_description').val();

      if(title.length > 0 && parseInt(sector) > 0 && address.length > 0 && suburb.length > 0 && state.length > 0 && postcode.length > 0 && quote.length > 0 && parseInt(values) > 0 && due_desc.length > 0){
        console.log("djsdjsahjdsahsa");
        $('.next_info').prop('disabled',false);
      }else{
        $('.next_info').prop('disabled',true);
      }
    }



    /*$('.wysihtml5').each(function(i, elem) {
      $(elem).wysihtml5({toolbar: {
        'font-styles': true,
        'color': false,
        'emphasis': {
          'small': true
        },
        'blockquote': true,
        'lists': true,
        'html': false,
        'link': false,
        'image': false,
        'smallmodals': false
      },
        events: {
          load: function() {
            $('.wysihtml5-sandbox').contents().find('body').on("keyup",function(event) {
              var l = event.currentTarget.innerText              if(l.length > 0){
                $('.about').hide();
              }else{
                $('.about').show();
              }

            });
          }
        }
      });
    });*/

    $('#address').keyup(function(){
      var address = $(this).val();
      console.log(address);
      initAutocomplete();
      //get_address_info(address);
    });
    $('#address').focusout(function(){
      var address = $(this).val();
      console.log(address);
      //initAutocomplete();
      get_address_info(address);
    });


    function initAutocomplete() {
      autocomplete = new google.maps.places.Autocomplete(
          (document.getElementById('address')),
          {types: ['geocode'],componentRestrictions: {country: "au"}});

      google.maps.event.addListener(autocomplete,'place_changed',function(){

        var address = $("#address").val();
        get_address_info(address);

      });
    }
    var add = "<%= @tender.present? ? @tender.address : nil %>"


    if(add.length > 0){
      $.ajax({
        method: "POST",
        data: {add:add},
        url: "/tenders/get_latling"
      }).done(function (data) {
        var myLatLng = {lat:data.latitude, lng: data.longitude};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: myLatLng
        });
        var marker = new google.maps.Marker({
          position: myLatLng,
          map: map
        });
      });
    }else{

      var myLatLng = {lat:-25.2744, lng: 133.7751};
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 3,
        center: myLatLng
      });
    }

    $(".title").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".title").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });


    $(".quote").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".quote").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });



    $(".client").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".client").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $(".architect").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".architect").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $("#categories").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $("#categories").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $("#values").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $("#values").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $("#about_me").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $("#about_me").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $(".address").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".address").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $(".suburb").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".suburb").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $(".state").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".state").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    $(".postcode").focusin(function() {
      $(this).css({"backgroundColor": "white", "border-color": "#629c44" ,"color": "#000000"});
    });
    $(".postcode").focusout(function() {
      $(this).css({"backgroundColor": "#f6f6f6", "color": "#000000","border-color": "#f6f6f6"});
    });

    function get_address_info(address){
      $.ajax({
        method: "POST",
        data: {address: address},
        url: "/users/get_address_info"
      }).done(function (data) {
        console.log(data);
        if(data.state = 'valid') {
          var new_add = address.split(",")
          $('#state').val(data.add_state);
          $('#suburb').val(data.suburb);
          $('#postcode').val(data.postal);
          $('#timezone').val(data.timezone);
          $('#address').val(new_add[0]);
          $('.o_address').val(address);
          console.log("data.latitude"+data.latitude)
          var myLatLng = {lat:data.latitude, lng: data.longitude};
          var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,           center: myLatLng
          });
          var marker = new google.maps.Marker({
            position: myLatLng,
            map: map
          });
        }
      });
    }

    $('.tendering').change(function(){
      var val = $(this).val();
      $('.submit_info').css({"backgroundColor": "#72bb53", "color": "#ffffff"});
      if(parseInt(val) == 1){
        $('.tendering_text').show();
        $('.awarded_text').hide();
      }else{
        $('.awarded_text').show();
        $('.tendering_text').hide();
      }
    });

    /*$('.quote_calender').click(function(){
      $('#datetimepicker1').datetimepicker({ minDate:new Date()});

      if(($('.quote').val()).length > 0){
        $(".quote_description").prop('disabled', false);
      }else{
        $(".quote_description").prop('disabled', true);
      }

    })*/

    var nowDate = new Date();
    var today = new Date(nowDate.getFullYear(), nowDate.getMonth(), nowDate.getDate(), 0, 0, 0, 0);
    $('.form_meridian_datetime').datetimepicker({
      startDate: today,
      format:"yyyy-mm-dd  HH:ii P",
      minDate: moment(12, 'h'),
      minView : 1,
      showMeridian:true,
      autoclose:true,
      todayBtn:true
    });

    $('.quote').datetimepicker({
      format: 'Y-m-d g:i A',
      formatTime: 'g:i A',
      ampm: true,
      minDate: nowDate,

    });
    /*$('.site_meridian_datetime').datetimepicker({
      startDate: today,
      format:"yyyy-mm-dd  HH:ii P",
      minDate: moment(12, 'h'),
      showMeridian:true,
      autoclose:true,
      todayBtn:true
    });

    $('.site_calendar').click(function(){
      $('#picker1').datetimepicker({ minDate:new Date()});
    })*/

    $('.add').click(function () {
      if($('.site').val().length <= 0){
        alert("Please insert date.");
      }else{
        var quote_date = $('.quote').val();
        var site_date = $('.site').val();
        var id  = $(this).attr('id');
        if(quote_date.length > 0){
          $.ajax({
            method: "POST",
            data: {id:id,site_date:site_date,quote_date:quote_date},
            url: "/tenders/new_site"
          }).done(function (data) {
            if(data.state != 'invalid'){
              $('.previous_site').html('');
              $('.site').val('');
              $('.new_site').html(data);
            }else{
              if(data.error == 'Quote'){
                alert("Date should not higher than quote date. Please try again.");
              }else{
                alert("Date already exist. Please try again.");
              }
            }

          });
        }else{
          alert("Please insert Due date first.");
        }

      }
    });

    $('.remove').click(function(){
      var id = $(this).attr('id');
      $.ajax({
        method: "POST",
        data: {id:id},
        url: "/tender_sites/delete_site"
      }).done(function (data) {
        $('.previous_site').html('');
        $('.new_site').html(data);
      });
    });
  });
</script>