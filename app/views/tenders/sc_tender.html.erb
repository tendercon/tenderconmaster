<div class="modal fade" id="yesModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <div style="height: 30px"></div>
        <div class="text-center">
          <h2 style="font-family: 'Montserrat', sans-serif;font-size: 30px">
            YOU HAVE ACCEPTED THE INVITATION
          </h2>
        </div>
        <div style="height: 30px"></div>
        <div class="text-center">
          <h4 style="font-family: 'Montserrat', sans-serif;font-size: 16px">
            Congratulations on accepting the invitation.! You may now access all details and documentation and under My Tenders
          </h4>
        </div>
        <div style="height: 30px"></div>
        <div class="text-center">
          <a href="/tenders/my_tender?subcontractor=true">
            <button class="btn btn-success" style="border-radius: 2px !important;background-color: #72BB53;height: 36px !important;width: 146px !important;" >
              <p style="margin-top: 1px; font-size: 14px">
                MY TENDERS
              </p>
            </button>
          </a>
          <a href="/tenders/invited_tender">
            <button class="btn btn-primary" style="border-radius: 2px !important;background-color: #1464F6;height: 36px !important;width: 146px !important;">
              <p style="margin-top: 1px; font-size: 14px">
                INVITED TENDERS
              </p>
            </button>
          </a>  
        </div>
        <div style="height: 20px"></div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="noModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <div style="height: 30px"></div>
        <div class="text-center">
          <h2 style="font-family: 'Montserrat', sans-serif;font-size: 30px">
            ARE YOU SURE?
          </h2>
        </div>
        <div style="height: 30px"></div>
        <div class="text-center">
          <h4 style="font-family: 'Montserrat', sans-serif;font-size: 16px">
            By accepting the Head Contractor's invitation, you will be able to quote on the selected trade,  strengthen your relationship with the Head Contractor and be prioritised for their future tenders.
          </h4>
        </div>
        <div style="height: 30px"></div>
        <div class="text-center">
          
          <button class="btn btn-success no_interested" style="border-radius: 2px !important;background-color: #E61610;height: 36px !important;width: 146px !important;" >
            <p style="margin-top: 1px; font-size: 14px">
              NO INTERESTED
            </p>
          </button>
          
          <a href="/tenders/invited_tender">
            <button class="btn btn-primary" style="border-radius: 2px !important;background-color: #72BB53;height: 36px !important;width: 146px !important;">
              <p style="margin-top: 1px; font-size: 14px">
                I'LL RETHINK
              </p>
            </button>
          </a>  
        </div>
        <div style="height: 20px"></div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="notInterestedModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <div style="height: 30px"></div>
        <div class="text-center">
          <h2 style="font-family: 'Montserrat', sans-serif;font-size: 30px">
            YOU HAVE REJECTED THE INVITATION
          </h2>
        </div>
        <div style="height: 30px"></div>
        <div class="text-center">
          <h4 style="font-family: 'Montserrat', sans-serif;font-size: 16px">
            The Head Contractor has been notified of your decision. Why not check out Open Tenders for more suitable opportunities?
          </h4>
        </div>
        <div style="height: 30px"></div>
        <div class="text-center">
          <a href="/tenders/open_tender">
            <button class="btn btn-success" style="border-radius: 2px !important;background-color: #72BB53;height: 36px !important;width: 146px !important;" >
              <p style="margin-top: 1px; font-size: 14px">
                OPEN TENDERS
              </p>
            </button>
          </a>
          <a href="/tenders/invited_tender">
            <button class="btn btn-primary" style="border-radius: 2px !important;background-color: #1464F6;height: 36px !important;width: 146px !important;">
              <p style="margin-top: 1px; font-size: 14px">
                INVITED TENDERS
              </p>
            </button>
          </a>  
        </div>
        <div style="height: 20px"></div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <input type="hidden" class="tender_id" value="<%= @tender.id %>">
  <input type="hidden" class="user_id" value="<%= session[:user_logged_id] %>">
  <div class="col-md-12">
    <% if params[:invited].present? %>
     <%= render 'tenders/invited_tenders/header_footer_div' %>
     
    <% end %>
    
    <div id="content">
      <div class="portlet-body" style="color: #2B3642;">
        <% unless params[:invited].present? %>
          <div class="row">
            <div class="container">
              <h2><%= "##{@tender.tendercon_id}- #{@tender.title}"  %></h2>
            </div>

          </div>
        <% else %>
          <div class="row">
            <div class="text-center">
              <h2><%= "##{@tender.tendercon_id}- #{@tender.title}"  %></h2>
            </div>

          </div>
        <% end %>  
        <div class="tabbable-line">
          <% unless params[:invited].present? %>
            <ul class="nav nav-tabs ">
              <% if params[:rfi].present? || params[:quote].present? || params[:reload].present? || params[:addenda].present? %>
                  <li><a href="#info" data-toggle="tab" id="<%= @tender.id %>">Details</a></li>
              <% else %>
                  <li class="active"><a href="#info" data-toggle="tab" id="<%= @tender.id %>">Details</a></li>
              <% end %>
              <% if get_tender_request_approved(@tender.id,session[:user_logged_id]) > 0 %>
                <li><a href="#document_control" data-toggle="tab" id="<%= @tender.id %>">Documents</a></li>
                <% if params[:addenda].present? %>
                  <li class="active"><a href="#addenda" data-toggle="tab" id="<%= @tender.id %>">Addenda</a></li>
                <% else %>
                  <li><a href="#addenda" data-toggle="tab" id="<%= @tender.id %>">Addenda</a></li>
                <% end %>
                <% if params[:quote].present? %>
                    <li class="active"><a href="#quote" data-toggle="tab" id="<%= @tender.id %>">Quotes</a></li>
                <% else %>
                    <li><a href="#quote" data-toggle="tab" id="<%= @tender.id %>">Quotes</a></li>
                <% end %>
              <% else %>
                  <li><a href="#document_control_disabled" data-toggle="tab" id="<%= @tender.id %>">Documents</a></li>
                  <li><a href="#addenda_disabled" data-toggle="tab" id="<%= @tender.id %>">Addenda</a></li>
                  <li><a href="#quote_disabled" data-toggle="tab" id="<%= @tender.id %>">Quotes</a></li>

              <% end %>
              
            </ul>
          <% end %>  
        </div>
      </div>
      <div id="my-tab-content" class="tab-content">
        <div class="row">
          <div class="form-group"></div>
        </div>
        <% if params[:rfi].present? || params[:quote].present? || params[:reload].present? || params[:addenda].present? %>
            <div class="tab-pane  col-md-12" id="info">
              <%= render 'tender_info' %>
            </div>
        <% else %>
            <div class="tab-pane active col-md-12" id="info">
              <%= render 'tender_info' %>
            </div>
        <% end %>
        <% if params[:addenda].present? %>
            <div class="tab-pane active col-md-12" id="addenda"></div>
        <% else %>
            <div class="tab-pane col-md-12" id="addenda"></div>
        <% end %>

        <div class="tab-pane col-md-12" id="addenda_disabled">
          <div class="text-center">
            <strong style="color: #525e64">INVITES SUBCONTRACTORS</strong>
            <p style="color: #95a5a6">Inviting Subcontractors to your Network will help you
              receive more quotes and make Tender Management much easier
            </p>
            <div style="height: 30px"></div>
            <div class="profile-userpic">
              <img src="/img/logos/Screen-Shot.png" class="img-responsive" alt="" style="width: 400px !important; height: 400px !important;">
            </div>
            <div style="height: 30px"></div>

            <div style="height: 30px"></div>
          </div>
        </div>
        <% if params[:rfi].present? || params[:reload].present? %>
            <div class="tab-pane active col-md-12" id="rfi">

            </div>
        <% else %>
            <div class="tab-pane col-md-12" id="rfi">

            </div>
        <% end %>

        <div class="tab-pane  col-md-12" id="document_control">

        </div>
        <div class="tab-pane  col-md-12" id="document_control_disabled">
          <div class="text-center">
            <strong style="color: #525e64">INVITES SUBCONTRACTORS</strong>
            <p style="color: #95a5a6">Inviting Subcontractors to your Network will help you
              receive more quotes and make Tender Management much easier
            </p>
            <div style="height: 30px"></div>
            <div class="profile-userpic">
              <img src="/img/logos/Screen-Shot.png" class="img-responsive" alt="" style="width: 400px !important; height: 400px !important;">
            </div>
            <div style="height: 30px"></div>

            <div style="height: 30px"></div>
          </div>
        </div>
        <div class="tab-pane col-md-12" id="chat">
          <%= render 'tender_chat' %>
        </div>

        <% if params[:quote].present? %>
            <div class="tab-pane active col-md-12" id="quote">

            </div>
        <% else %>
            <div class="tab-pane col-md-12" id="quote">

            </div>
            <div class="tab-pane col-md-12" id="quote_disabled">
              <div class="text-center">
                <strong style="color: #525e64">INVITES SUBCONTRACTORS</strong>
                <p style="color: #95a5a6">Inviting Subcontractors to your Network will help you
                  receive more quotes and make Tender Management much easier
                </p>
                <div style="height: 30px"></div>
                <div class="profile-userpic">
                  <img src="/img/logos/Screen-Shot.png" class="img-responsive" alt="" style="width: 400px !important; height: 400px !important;">
                </div>
                <div style="height: 30px"></div>

                <div style="height: 30px"></div>
              </div>
            </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<div id="sample_modal" class=" popup-basic admin-form mfp-with-anim mfp-hide">
  <div class="panel">
    <div class="panel-heading">
              <span class="panel-title">
                <i class="fa fa-rocket"></i>Leave a comment</span>
    </div>
    <!-- end .panel-heading section -->

    <form method="post" action="/" id="comment">
      <div class="panel-body p25">
        <div class="section row">
          <div class="col-md-6">
            <label for="firstname" class="field prepend-icon">
              <input type="text" name="firstname" id="firstname" class="gui-input" placeholder="First name...">
              <label for="firstname" class="field-icon">
                <i class="fa fa-user"></i>
              </label>
            </label>
          </div>
          <!-- end section -->

          <div class="col-md-6">
            <label for="lastname" class="field prepend-icon">
              <input type="text" name="lastname" id="lastname" class="gui-input" placeholder="Last name...">
              <label for="lastname" class="field-icon">
                <i class="fa fa-user"></i>
              </label>
            </label>
          </div>
          <!-- end section -->

        </div>
        <!-- end section row section -->

        <div class="section row">
          <div class="col-md-6">
            <label for="email" class="field prepend-icon">
              <input type="email" name="email" id="email" class="gui-input" placeholder="Email address">
              <label for="email" class="field-icon">
                <i class="fa fa-envelope"></i>
              </label>
            </label>
          </div>
          <!-- end section -->

          <div class="col-md-6">
            <label for="website" class="field prepend-icon">
              <input type="url" name="website" id="lastname" class="gui-input" placeholder="Website url...">
              <label for="website" class="field-icon">
                <i class="fa fa-globe"></i>
              </label>
            </label>
          </div>
          <!-- end section -->

        </div>
        <!-- end section row section -->

        <div class="section">
          <label for="comment" class="field prepend-icon">
            <textarea class="gui-textarea" id="comment" name="comment" placeholder="Your comment"></textarea>
            <label for="comment" class="field-icon">
              <i class="fa fa-comments"></i>
            </label>
                    <span class="input-footer">
                      <strong>Hey You:</strong> We expect a great comment...</span>
          </label>
        </div>
        <!-- end section -->

      </div>
      <!-- end .form-body section -->

      <div class="panel-footer">
        <button type="submit" class="button btn-primary">Post Comment</button>
        <button type="button" class="button btn-default popup-modal-dismiss">Close</button>
      </div>
      <!-- end .form-footer section -->
    </form>
  </div>
  <!-- end: .panel -->
</div>

<input type="hidden" class="rfi" value="<%= params[:rfi] %>">
<input type="hidden" class="quote" value="<%= params[:quote] %>">
<input type="hidden"  class="tender_id" value="<%= @tender.id %>">
<input type="hidden"  class="sc_id" value="<%= session[:user_logged_id] %>">
<input type="hidden"  class="trade_id" value="<%= params[:trade] %>">
<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyA7B-_hoQVA07h-qSd3E-HXxyXnM9W4zC8&libraries=places&sensor=false"></script>â€¨
<script>


  $(document).ready(function(){
    $('.yes_btn').click(function(){
      var tender_id = $('.tender_id').val();
      var sc_id = $('.sc_id').val();
      var trade = $('.trade_id').val();

      var ids = []
      ids.push(trade);
      
      console.log(ids)
      $.ajax({
        method: "POST",
        data: {tender_id:tender_id,sc_id:sc_id,ids:ids,tender_detail:true},
        url: "/tenders/request_to_quote"
      }).done(function (data) {
        $('#yesModal').modal('show');
      });  
      
    });

    $('.no_btn').click(function(){
      $('#noModal').modal('show');
      
    });

    $('.no_interested').click(function(){

      var tender_id = $('.tender_id').val();
      var sc_id = $('.sc_id').val();
      var trade = $('.trade_id').val();
      
      var ids = []
      ids.push(trade);
      
      console.log(ids)
      $.ajax({
        method: "POST",
        data: {tender_id:tender_id,id:sc_id,trade:trade},
        url: "/invites/decline_trade_invite"
      }).done(function (data) {
        $('#noModal').modal('hide');
        $('#notInterestedModal').modal('show'); 
      }); 
    });

    <% if params[:reload].present? || params[:rfi].present?  %>
      var tender_id = $('.tender_id').val();
      $.ajax({
        method: "POST",
        data: {tender_id:tender_id},
        url: "/rfis/get_latest_rfis"
      }).done(function (data) {
        $('#rfi').html(data);
      });

    <% end %>

    <% if params[:addenda].present?  %>
      var tender_id = $('.tender_id').val();
      $.ajax({
        method: "POST",
        data: {tender_id:tender_id},
        url: "/addendas/get_addendas"
      }).done(function (data) {
        $('#addenda').html(data);
      });
    <% end %>

    var rfi = $('.rfi').val();
    var quote = $('.quote').val();
    $('.download_package').change(function(){
      var tender_id = $('.tender_id').val();
      var user_id = $('.user_id').val();
      var trade = $(this).val();

      console.log("trade:"+$(this).val());
      console.log("user_id:"+ user_id);
      $.ajax({
        method: "POST",
        data: {tender_id:tender_id,user_id:user_id,trade:trade},
        url: "/package_downloads/save_download"
      }).done(function (data) {

      });
    });

    $('.tenders').each(function(){
      var id =  $(this).val();
      var add = $('.add'+id).val();

    });

    if(rfi == 'true'){
      var tender_id = $('.tender_id').val();
      $.ajax({
        method: "POST",
        data: {tender_id:tender_id},
        url: "/rfis/get_latest_rfis"
      }).done(function (data) {
        $('#rfi').html(data);
      });
    }

    if(quote == 'true'){
      var tender_id = $('.tender_id').val();
      $.ajax({
        method: "POST",
        data: {tender_id:tender_id},
        url: "/quotes/get_latest_quotes"
      }).done(function (data) {
        $('#quote').html(data);
      });
    }

    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      var target = $(e.target).attr("href"); // activated tab
      var id = $(e.target).attr("id");

      if(target == '#chat'){
        var tender_id = $('.tender_id').val();
        $.ajax({
          method: "POST",
          data: {tender_id:tender_id},
          url: "/tenders/get_latest_chat"
        }).done(function (data) {
          $('#chat').html(data);
        });
      }else if(target == '#rfi'){
        var tender_id = $('.tender_id').val();
        $.ajax({
          method: "POST",
          data: {tender_id:tender_id},
          url: "/rfis/get_latest_rfis"
        }).done(function (data) {
          $('#rfi').html(data);
        });
      }else if(target == '#quote'){
        var tender_id = $('.tender_id').val();
        $.ajax({
          method: "POST",
          data: {tender_id:tender_id},
          url: "/quotes/get_latest_quotes"
        }).done(function (data) {
          $('#quote').html(data);
        });
      }else if(target == '#addenda'){
        var tender_id = $('.tender_id').val();
        $.ajax({
          method: "POST",
          data: {tender_id:tender_id},
          url: "/addendas/get_addendas"
        }).done(function (data) {
          $('#addenda').html(data);
        });
      }else if(target == '#document_control'){
        var tender_id = $('.tender_id').val();
        $.ajax({
          method: "POST",
          data: {tender_id:tender_id},
          url: "/tenders/get_document_control_per_sc"
        }).done(function (data) {
          $('#document_control').html(data);
        });
      }
    });


    $(document).ready(function(){
      var map;
      var id = $('.tender_id').val();
      var myLatLng;
      load_map();
      function load_map() {
        var add = $('.add'+id).val();

        $.ajax({
          method: "POST",
          data: {add:add},
          url: "/tenders/get_latling"
        }).done(function (data) {

          myLatLng = {lat:data.latitude, lng: data.longitude};

          map = new google.maps.Map(document.getElementById('map_'+id), {
            zoom: 15,
            center: myLatLng
          });

          var marker = new google.maps.Marker({
            position: myLatLng,
            map: map
          });

          google.maps.event.addListenerOnce(map, 'idle', function() {
            google.maps.event.trigger(map, 'resize');
            map.setCenter(myLatLng);
          });
        });

      }

      $('a[href="#red"]').on('shown.bs.tab', function() {


        google.maps.event.trigger(map, 'resize');
        load_map();
      });

    });

    $('.full_screen').click(function(){
      $('.menu-toggler').click();
    });


    $('.wiki').magnificPopup({
      type: 'inline',
      items: {src: '#sample_modal'},
      preloader: false,
      modal: true
    });

    $('.popup-modal-dismiss').click(function(){
      $.magnificPopup.close();
      $('form')[0].reset();
    });

  })


</script>