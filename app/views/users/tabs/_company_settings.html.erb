<form  id="info" action="" method="POST">
  <div class="text-center">
    <input type="hidden" class="address_for_map" value="<%= @user.address.present? ? "#{@user.address.location}" : nil %>">
    <h2 style="font-family: Gotham;font-size: 30px"><strong>UPDATE COMPANY PROFILE</strong></h2>
    <h4 style="font-family: Gotham;font-size: 16px">Edit and Update your company profile information</h4>
    <div style="height: 20px"></div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-6">
      <u>
        <h3 style="font-family: Gotham;font-size: 24px">
          DIGITAL PRESENCE
        </h3>  
      </u>
    </div>
    <div class="col-md-2"></div>
  </div> 
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        WEBSITE
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="website" value="<%= @added_company_profile.present? ? @added_company_profile.website : nil %>" />
      </div>
    </div>
  </div>  
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        LINKED URL
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="linkedin" value="<%= @added_company_profile.present? ? @added_company_profile.linkedin : nil %>" />
      </div>
    </div>
  </div>   
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        FACEBOOK URL
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="facebook" value="<%= @added_company_profile.present? ? @added_company_profile.facebook : nil %>" />
      </div>
    </div>
  </div>  
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        TWITTER URL
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="twitter" value="<%= @added_company_profile.present? ? @added_company_profile.twitter : nil %>" />
      </div>
    </div>
  </div>  
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-6">
      <u>
        <h3 style="font-family: Gotham;font-size: 24px">
          TENDERCON ID
        </h3>  
      </u>
    </div>
    <div class="col-md-2"></div>
  </div>


  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        TENDERCON ID
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="tendercon_id" value="<%= "#{@user.tendercon_id}" %>" readonly/>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        MEMBER SINCE
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="member_since" value="<%= "#{@user.created_at.strftime("%B %Y")}" %>" readonly/>
      </div>
    </div>
  </div>
  <div style="height: 10px"></div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-6">
      <u>
        <h3 style="font-family: Gotham;font-size: 24px">
          COMPANY DETAILS
        </h3>  
      </u>
    </div>
    <div class="col-md-2"></div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        COMPANY NAME
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="company" value="<%= "#{@user.company}" %>" readonly/>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        TRADING AS
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="trade_name" value="<%= "#{@user.trade_name}" %>"/>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        ABN
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="abn" value="<%= "#{@user.abn}" %>" readonly/>
      </div> 
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        ACN
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="acn" value="<%= @added_company_profile.present? ? @added_company_profile.acn : nil %>"/>
      </div> 
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        # OF EMPLOYEES
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
      <%= select_tag "number_of_employees", options_for_select([ "","1 to 5", "5 to 10","10-15","15-20","20-25","25-50","50-75","75-100","100+"] , @added_company_profile.present? ? @added_company_profile.number_of_employees : "" ),{:class => 'form-control'} %>
    </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        YEARS IN OPERATION
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="commenced_operation" value="<%= @added_company_profile.present? ? @added_company_profile.commenced_operation : nil %>" readonly/>
      </div>
    </div>
  </div>
  <% if session[:role] == 'Sub Contractor' %>

    <div style="height: 10px"></div>
    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-6">
        <u>
          <h3 style="font-family: Gotham;font-size: 24px">
            TRADE SPECIALISATION
          </h3>  
        </u>
        
      </div>
      <div class="col-md-2"></div>
    </div>


    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-3">
        <h4 style="font-family: Gotham;font-size: 16px">
            PROJECT SIZE RANGE 
          </h4>
      </div>
      <div class="col-md-5">
        <div class="form-group">
          <div class="col-md-6">
            <%= select_tag "from", options_for_select(@from,@p_to.present? ? @p_to[0] : ''),{:class => 'form-control'} %>
          </div>
          <div class="col-md-6">
            <%= select_tag "to", options_for_select(@to,@p_to.present? ? @p_to[1] : ''),{:class => 'form-control'} %>
          </div>
         </div>
      </div>
    </div>


    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-3">
        <h4 style="font-family: Gotham;font-size: 16px">
          PRIMARY TRADE
        </h4>
      </div>
      <div class="col-md-5">
        <div class="form-group">
        <%= select_tag 'primary_trade',content_tag(:option,'None',:value=>0)+options_from_collection_for_select(@trades, 'id','name',(@primary_trade.present? ? @primary_trade.trade_id : nil))+content_tag(:option,'Others',:value=>'last'),{:class=> 'form-control'} %>
      </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-3">
        <h4 style="font-family: Gotham;font-size: 16px">
          SECONDARY TRADE
        </h4>
      </div>
      <div class="col-md-5">
        <div class="form-group">
          <%= select_tag 'secondary_trade1',content_tag(:option,'None',:value=>0)+options_from_collection_for_select(@trades, 'id','name',(@secondary_trade_array.present? ? @secondary_trade_array[0] : nil))+content_tag(:option,'Others',:value=>'last'),{:class=> 'form-control'} %>
        </div>
        <div class="form-group">
          <%= select_tag 'secondary_trade2',content_tag(:option,'None',:value=>0)+options_from_collection_for_select(@trades, 'id','name',(@primary_trade.present? ? @secondary_trade_array[1] : nil))+content_tag(:option,'Others',:value=>'last'),{:class=> 'form-control'} %>
        </div>
        <div class="form-group">
          <%= select_tag 'secondary_trade3',content_tag(:option,'None',:value=>0)+options_from_collection_for_select(@trades, 'id','name',(@primary_trade.present? ? @secondary_trade_array[2] : nil))+content_tag(:option,'Others',:value=>'last'),{:class=> 'form-control'} %>
        </div>
        <div class="form-group">
          <%= select_tag 'secondary_trade4',content_tag(:option,'None',:value=>0)+options_from_collection_for_select(@trades, 'id','name',(@primary_trade.present? ? @secondary_trade_array[3] : nil))+content_tag(:option,'Others',:value=>'last'),{:class=> 'form-control'} %>
        </div>
        <div class="form-group">
          <%= select_tag 'secondary_trade5',content_tag(:option,'None',:value=>0)+options_from_collection_for_select(@trades, 'id','name',(@primary_trade.present? ? @secondary_trade_array[4] : nil))+content_tag(:option,'Others',:value=>'last'),{:class=> 'form-control'} %>
        </div>
        
      </div>
    </div>
  <% end %> 
  <div style="height: 10px"></div> 
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-6">
      <u>
        <h3 style="font-family: Gotham;font-size: 24px">
          COMPANY CONTACT INFO
        </h3>  
      </u>
    </div>
    <div class="col-md-2"></div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        KEY POINT OF CONTACT
      </h4>
    </div>
    <div class="col-md-5">
      <input type="text"  class="form-control"  name="company_contact" value="<%= @added_company_profile.present? ? @added_company_profile.contact : nil %>" />
    </div>
  </div>

  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        POSITION
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
         <%= select_tag 'position',content_tag(:option,'Select position',:value=>0)+options_from_collection_for_select(@positions, 'id','title', @added_company_profile.present? ? @added_company_profile.position : 0 )+content_tag(:option,'Others',:value=>'last'),{:class=> 'form-control'} %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        PHONE/MOBILE
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="contact_number" value=" <%= @added_company_profile.present? ? @added_company_profile.contact_number : nil  %>" />
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        EMAIL
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="contact_email" value=" <%= @added_company_profile.present? ? @added_company_profile.email : nil %>" />
      </div>
        
    </div>
  </div>
  <div style="height: 10px"></div> 
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-6">
      <u>
        <h3 style="font-family: Gotham;font-size: 24px">
          LOCATION
        </h3>  
      </u>
    </div>
    <div class="col-md-2"></div>
  </div>


  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        ADDRESS
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="address" value=" <%= @user.address.present? ? "#{@user.address.location}" : nil %>" id="address"/>
        <input type="hidden" name="suburb" class="suburb">
        <input type="hidden" name="postcode" class="postcode">
        <input type="hidden" name="state" class="state">
        <input type="hidden" name="timezone" class="timezone">
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-3">
      <h4 style="font-family: Gotham;font-size: 16px">
        TIME ZONE
      </h4>
    </div>
    <div class="col-md-5">
      <div class="form-group">
        <input type="text"  class="form-control"  name="timezone" value=" <%= @user.address.present? ? "#{@user.address.timezone}" : nil %>" readonly/>
      </div>
    </div>
  </div>
  <div style="height: 10px"></div> 
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-6">
      <u>
        <h3 style="font-family: Gotham;font-size: 24px">
          MAP
        </h3>  
      </u>
    </div>
    <div class="col-md-2"></div>
  </div>
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-8">
      <div id="map" style="height:270px;width:100%;"></div> 
    </div>
  </div>

  <div class="row">
    <div class="margin-top-10 pull-right" style="margin-right: 10px">
      <a href="/users/company_profile?id=<%= @user.id %>" class="btn red">
        <button class="btn red" type="button">
          Cancel
        </button>
      </a>
      <a href="#!" class="btn green">
        <button class="btn green" type="submit">
          Save Changes
        </button>
      </a>
    </div>
    
  </div>
</form>

<script type="text/javascript">
  $(document).ready(function(){
    $('#info').on('submit', function (e) {

      e.preventDefault();
      console.log($('#info').serialize())
      $.ajax({
        method: "POST",
        data: $('#info').serialize(),
        url: "/users/update_company_info"
      }).done(function (data) {
        console.log(data);
        window.location.href = "/users/company_profile?id=<%= @user.id %>";
        ///users/company_profile?id=28
        /*if(data.state == 'valid'){
          $('#users_success').show();
        }*/
      });
    });

    $('#address').keyup(function(){
      console.log("TEST");
      var address = $(this).val();
      initAutocomplete();
      get_address_info(address);
    });

    $('#address').focusout(function(){
      var address = $(this).val();
      initAutocomplete();
      get_address_info(address);
    });

    function initAutocomplete() {
      autocomplete = new google.maps.places.Autocomplete(
          (document.getElementById('address')),
          {types: ['geocode'],componentRestrictions: {country: "au"}});

      google.maps.event.addListener(autocomplete,'place_changed',function(){

        var address = $("#address").val();
        console.log("test:"+address);

      });
    }

    function get_address_info(address){
      $.ajax({
        method: "POST",
        data: {address: address},
        url: "/users/get_address_info"
      }).done(function (data) {
        if(data.state = 'valid') {
          console.log("data.add_state:"+data.add_state)
          $('.state').val(data.add_state);
          $('.suburb').val(data.suburb);
          $('.postcode').val(data.postal);
          $('.timezone').val(data.timezone);

        }
      });
    }
  });
</script>