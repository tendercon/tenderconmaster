

<div class="row">
  <div class="form-group"></div>

  <div class="col-md-12">
    <h1>YOUR PLAN</h1>
  </div>
</div>

<div class="row" >
  <div class="col-md-12">
    <h1><%#= @user_plan.present? ? (get_user_plan @user_plan.user_id) : nil %></h1>
  </div>
</div>

<input type="hidden" class="user_id" value="<%= @user_plan.present? ? @user_plan.user_id : nil%>">
<div class="row">
  <div class="col-md-12 users">
    <% if @user_plan.present? && @user_plan.plan.to_i == 0  %>
        <% if @user_plan.present? %>
            <div class="row">
              <div class="col-md-12">
                <table  class="table table-bordered">
                  <thead>
                  <% if @user_plan.present? %>
                      <tr style="background-color: #2C3E50;color: white;">
                        <th>Starting Date</th>
                        <th >Subscription</th>
                        <th>Amount</th>
                        <th>Expiry Date</th>
                        <% if !@request_upgrade.present? %>
                            <th></th>
                        <% end %>
                      </tr>
                  <% end %>
                  </thead>
                  <tbody>
                  <% if @user_plan.present? %>
                      <tr>
                        <td class="text-center"><%= @user_plan.created_at.strftime("%m/%d/%Y") %></td>
                        <td class="text-center"><%=  user_plan @user_plan.user_id %>
                          <div style="height: 10px"></div>
                          <label style="color: red">Quote on 3 Tenders a Month</label>
                        </td>
                        <td class="text-center">$<%= @user_plan.amount %></td>
                        <td class="text-center"><%= (@user_plan.created_at + 1.month).strftime("%m/%d/%Y") %></td>
                        <% if !@request_upgrade.present? %>
                            <td class="text-center">
                              <a href="#!">
                                <button class="btn btn-success upgrade">Upgrade To Professional</button>
                              </a>
                            </td>
                        <% end %>
                      </tr>
                  <% else %>
                      <tr>
                        <td style="color: grey;">No Users.</td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>

            </div>
        <% end %>

        <div class="form-group"></div>
        <% if @request_upgrade.present? %>
            <div class="row">
              <div class="col-md-12">
                <table  class="table table-striped table-bordered">
                  <thead>
                  <% if @request_upgrade.present? %>
                      <tr style="background-color: #2C3E50;color: white;">
                        <th class="col-md-1">Starting Date</th>
                        <th class="col-md-2">Subscription</th>
                        <th class="col-md-2">Amount</th>
                        <th class="col-md-3">Expiry Date</th>
                        <th class="col-md-3"></th>
                      </tr>
                  <% end %>
                  </thead>
                  <tbody>
                  <% if @request_upgrade.present? %>
                      <tr>
                        <td class="col-md-1"><%= @request_upgrade.created_at.strftime("%m/%d/%Y") %></td>
                        <td class="col-md-2"><%=  user_plan @request_upgrade.user_id %></td>
                        <td class="col-md-2">$<%= user_subscription_amount @request_upgrade.user_id %></td>
                        <td class="col-md-2">Pending</td>
                        <td class="col-md-2">
                          <a href="#!">
                            <button class="btn btn-warning">Upgraded Requested</button>
                          </a>
                        </td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>
            </div>
        <% end %>

        <div class="row">
          <div class="form-group"></div>
        </div>

        <div class="text-center" style="display: none">
          <p style="font-size: 14px;">New Tenders were added to Tendercon in last 30 days,</p>
          <p style="font-size: 14px;">upgrade to the Professional Plan to access them all</p>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <div class="col-md-12">
                <h1>UPGRADE PLAN</h1>
              </div>
            </div>
            <table class="table table-bordered">
              <thead>
              <tr>
                <td colspan="3">New Tenders were added to Tendercon in last 30 days,upgrade to the Professional Plan to access them all</td>
              </tr>
              <tr style="background-color: #2C3E50;color: white;">
                <th>Features</th>
                <th class="col-md-3">Starter</th>
                <th class="col-md-3">Professional</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td style="background-color: #fafafa;color: black">Tenders/Month</td>
                <td class="text-center">3</td>
                <td class="text-center" style="color: green">Unlimited</td>
              </tr>
              <tr>
                <td style="background-color: #fafafa;color: black">Archived Tenders</td>
                <td class="text-center">3</td>
                <td class="text-center" style="color: green">Unlimited</td>
              </tr>
              <tr>
                <td style="background-color: #fafafa;color: black">Feature</td>
                <td class="text-center">
                  <i class="fa fa-times-circle fa-2x" aria-hidden="true" style="color: red"></i>
                </td>
                <td class="text-center" style="color: green">
                  <i class="fa fa-check-circle fa-2x" aria-hidden="true" style="color: green"></i>
                </td>
              </tr>
              <tr>
                <td style="background-color: #fafafa;color: black">Feature</td>
                <td class="text-center">
                  <i class="fa fa-times-circle fa-2x" aria-hidden="true" style="color: red"></i>
                </td>
                <td class="text-center" style="color: green">
                  <i class="fa fa-check-circle fa-2x" aria-hidden="true" style="color: green"></i>
                </td>
              </tr>
              <tr>
                <td style="background-color: #fafafa;color: black">Feature</td>
                <td class="text-center">
                  <i class="fa fa-times-circle fa-2x" aria-hidden="true" style="color: red"></i>
                </td>
                <td class="text-center" style="color: green">
                  <i class="fa fa-check-circle fa-2x" aria-hidden="true" style="color: green"></i>
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                </td>
                <td class="text-center">
                  <a href="#!">
                    <button class="btn btn-success upgrade pull-right"> Upgrade Plan</button>
                  </a>
                </td>
              </tr>
              </tbody>
            </table>
            <div class="row">
              <div class="col-md-12">
                <div class="form-group">

                </div>
              </div>
            </div>
          </div>

        </div>
    <% end %>


    <% if @user_plan.present? && @user_plan.plan.to_i == 1  %>
        <% if @user_plan.present? %>
            <div class="row">
              <table  class="table table-striped table-bordered">
                <thead>
                <% if @user_plan.present? %>
                    <tr>
                      <th class="col-md-1">Starting Date</th>
                      <th class="col-md-2">Subscription</th>
                      <th class="col-md-2">Amount</th>
                      <th class="col-md-3">Expiry Date</th>
                      <% if !@request_upgrade.present? %>
                          <th class="col-md-3"></th>
                      <% end %>
                    </tr>
                <% end %>
                </thead>
                <tbody>
                <% if @user_plan.present? %>
                    <tr>
                      <td class="col-md-1"><%= @user_plan.created_at.strftime("%m/%d/%Y") %></td>
                      <td class="col-md-2"><%=  user_plan @user_plan.user_id %></td>
                      <td class="col-md-2">$<%= @user_plan.amount %></td>
                      <td class="col-md-2"><%= (@user_plan.created_at + 1.month).strftime("%m/%d/%Y") %></td>

                      <% if @user_plan.plan.to_i == 1 || @user_plan.plan.to_i == 0 %>
                          <% if !@request_upgrade.present? %>
                              <td class="col-md-2">
                                <a href="#!">
                                  <button class="btn btn-primary upgrade_to_annual">Upgrade to Professional - 12 months</button>
                                </a>
                              </td>
                          <% end %>
                      <% end %>

                    </tr>
                <% else %>
                    <tr>
                      <td style="color: grey;">No Users.</td>
                    </tr>
                <% end %>
                </tbody>
              </table>
            </div>
        <% end %>
        <div class="row">
          <div class="form-group"></div>
        </div>
        <% if @request_upgrade.present? %>
            <div class="row">
              <div class="form-group">
                <table  class="table table-striped table-bordered">
                  <thead>
                  <% if @request_upgrade.present? %>
                      <tr>
                        <th class="col-md-1">Starting Date</th>
                        <th class="col-md-2">Subscription</th>
                        <th class="col-md-2">Amount</th>
                        <th class="col-md-3">Expiry Date</th>
                        <th class="col-md-3"></th>
                      </tr>
                  <% end %>
                  </thead>
                  <tbody>
                  <% if @request_upgrade.present? %>
                      <tr>
                        <td class="col-md-1"><%= @request_upgrade.created_at.strftime("%m/%d/%Y") %></td>
                        <td class="col-md-2"><%=  user_plan @request_upgrade.user_id %></td>
                        <td class="col-md-2">$<%= user_subscription_amount @request_upgrade.user_id %></td>
                        <td class="col-md-2">Pending</td>
                        <td class="col-md-2">
                          <a href="#!">
                            <button class="btn btn-warning">Upgraded Requested</button>
                          </a>
                        </td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>
            </div>
        <% end %>
    <% end %>

    <% if @user_plan.present? && @user_plan.plan.to_i == 2  %>
        <% if @user_plan.present? %>
            <div class="row">
              <table  class="table table-striped table-bordered">
                <thead>
                <% if @user_plan.present? %>
                    <tr>
                      <th class="col-md-1">Starting Date</th>
                      <th class="col-md-2">Subscription</th>
                      <th class="col-md-2">Amount</th>
                      <th class="col-md-3">Expiry Date</th>
                    </tr>
                <% end %>
                </thead>
                <tbody>
                <% if @user_plan.present? %>
                    <tr>
                      <td class="col-md-1"><%= @user_plan.created_at.strftime("%m/%d/%Y") %></td>
                      <td class="col-md-2"><%=  user_plan @user_plan.user_id %></td>
                      <td class="col-md-2">$<%= @user_plan.amount %></td>
                      <td class="col-md-2"><%= (@user_plan.created_at + 1.month).strftime("%m/%d/%Y") %></td>
                    </tr>
                <% else %>
                    <tr>
                      <td style="color: grey;">No Users.</td>
                    </tr>
                <% end %>
                </tbody>
              </table>
            </div>
        <% end %>
    <% end %>

  </div>
</div>

<div class="row">

  <div class="form-group"></div>
  <div class="col-md-12">

  </div>
</div>



</div>

<div class="paid_plan">
  <div id="paid_Modal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false" style="margin-top: 100px;" >
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h1>Available Professional Plan</h1>
        </div>
        <br>
        <div class="modal-body">

          <div class="row">
            <div class="form-group">

            </div>
            <div class="col-md-12">
              <div class="text-center" style="height: 150px;background-color: #d4d4d4;border-radius: 10px;">
                <div class="monthly" style="margin-top: 70px">
                  <p class="user_profile_2header"><h1 class="text-center">$49.50</h1></p>
                  <p class="user_profile_2header text-center">12 months</p>
                  <input type="hidden" class="high_plan" value="2">
                  <input type="hidden" class="user_id" value="<%= @user_plan.present? ? @user_plan.user_id : nil%>">
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="form-group">

            </div>
            <div class="text-center">
              <a href="#!">
                <button class=" btn btn-success submit_pay_invite" type="button">SEND REQUEST TO ADMIN</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="new_paid_plan">
  <div id="new_paid_Modal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false" style="margin-top: 100px;" >
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h1>Finalize Your Professional Plan</h1>
        </div>
        <br>
        <div class="modal-body">
          <div class="row">
            <div class="form-group">

            </div>
            <div class="col-md-12">

              <div class="col-md-6">

                  <label><input type="radio" name="optradio" value="2" class="sub" checked> Pay Annually(SAVE 25%)</label>

                  <label><input type="radio" name="optradio" value="1" class="sub"> Pay Monthly</label>

                <p>All plan are GST inclusive</p>
              </div>

              <div class="col-md-6" style="height: 150px;background-color: #d4d4d4;border-radius: 10px;">
                <div class="annual" style="margin-top: 70px;">
                  <p class="user_profile_2header"><h1 class="text-center">$49.50</h1></p>
                  <p class="user_profile_2header text-center">12 months</p>
                </div>
                <div class="monthly" style="margin-top: 70px;display: none;">
                  <p class="user_profile_2header"><h1 class="text-center">$66.00</h1></p>
                  <p class="user_profile_2header text-center">per month</p>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group">

            </div>
            <div class="col-md-12">
              <div class="checkbox">
                <label>Your request will be submitted to the Team Admin who will process your upgrade request.</label>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group">

            </div>
            <div class="text-center ">
              <a href="#!">
                <button class=" btn btn-success new_submit" type="button">SEND REQUEST TO ADMIN</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="sent_request">
  <div id="sent_Modal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false" style="margin-top: 100px;" >
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content" style=" height:450px;overflow:auto;">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h1 class="text-center">YOUR REQUEST HAS BEEN SENT</h1>
        </div>
        <br>
        <div class="modal-body">
          <div class="row">
            <div class="form-group">

            </div>

            <div class="col-md-12">
              <h1>WHAT HAPPENS NOW</h1>
            </div>
          </div>
          <div class="row">
            <div class="form-group"></div>
            <div class="form-group"></div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="col-md-4">
                <i class="fa fa-envelope-square fa-3x" aria-hidden="true" style="color: #00ABEA"></i>
              </div>
              <div class="col-md-8">
                <p class="success_invites">Your company Admin has been sent a request to upgrade your</p>
                <p class="success_invites">account</p>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group">

            </div>

            <div class="col-md-12">
              <h1>WHAT HAPPENS NEXT?</h1>
            </div>
          </div>
          <div class="row">
            <div class="form-group"></div>
            <div class="form-group"></div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="col-md-4">
                <i class="fa fa-chevron-circle-up fa-3x" aria-hidden="true" style="color: green"></i>
              </div>
              <div class="col-md-8">
                <p class="success_invites">The Company Admin will process your request and </p>
                <p class="success_invites">once approved, your Tendercon account will be upgraded</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  $('.upgrade_to_annual').click(function(){
    $('#paid_Modal').modal('show');
  });

  $('.submit_pay_invite').click(function(){
    var user_id = <%= @user_plan.user_id %>;
    var plan = $('.high_plan').val();

    $.ajax({
      method: "POST",
      data: {user_id: user_id,plan:plan},
      url: "/request_upgrades/save_request_upgrade"
    }).done(function (data) {
      if(data.state == 'valid'){
        window.location = "/users/subscription?sent=true";
      }
    });
  });

  $('.upgrade').click(function(){
    $('#new_paid_Modal').modal('show');
  });

  $('.sub').change(function(){

    var val = $(this).val();
    $('.paying_plan').val(val);
    if(parseInt(val) == 2){
      $('.annual').show();
      $('.monthly').hide();
    }else if(parseInt(val) == 1){
      $('.annual').hide();
      $('.monthly').show();
    }
  });

  $('.new_submit').click(function(){
    var user_id = <%= @user_plan.user_id %>;
    var plan = $('input[name="optradio"]:checked').val();
    $.ajax({
      method: "POST",
      data: {user_id: user_id,plan:plan},
      url: "/request_upgrades/save_request_upgrade"
    }).done(function (data) {
      if(data.state == 'valid'){
        $('#new_paid_Modal').modal('hide');
        $('#sent_Modal').modal('show');
        //window.location = "/users/subscription?sent=true";
      }
    });
  });



  $('.close').click(function(){
    //window.location = "/users/subscription?sent=true";
  });
</script>