
<table  class="table table-bordered responsive" id="updated_addenda_document_table"  cellspacing="0" width="100%">
  <thead>
  <tr style="background-color: #2C3E50;color: white;">
    <th><input type="checkbox" class="document_list_master" name="document_list_master"></th>
    <th class="text-center"><h4 style="font-family: Gotham">DOCUMENT</h4></th>
    <th class="text-center"><h4 style="font-family: Gotham">SIZE</h4></th>
    <th class="text-center"><h4 style="font-family: Gotham">Directory</h4></th>
    <th class="text-center"><h4 style="font-family: Gotham">ADD FILE TO FOLDER </h4></th>
  </tr>
  </thead>
  <tbody class="searchable">
  <% if @documents.present? %>
      <% @documents.each do |t| %>
          <tr>
            <td><input type="checkbox" class="document_list" name="documents[]" value="<%= t.id %>"></td>
            <td class="text-center"><%= t.document_file_name %></td>
            <td class="text-center"> <%= convert_kb_to_mb t.document_file_size %> MB</td>
            <td class="text-center"><%= t.directory %></td>
            <td class="text-center">
              <i class="fa fa-che ck" aria-hidden="true" style="color: green"></i>
            </td>
          </tr>
      <% end %>
  <% end %>
  </tbody>
</table>  



<script>
  $(document).ready(function(){
    $('#updated_addenda_document_table').DataTable({
      "bSort" : false,
      "bPaginate": false,
      "bFilter": false, 
      "bInfo": false,
      "columnDefs": [
        { "visible": false, "targets": 3 }
      ],
      "order": [[ 3, 'asc' ]],
      "displayLength": 25,
      "drawCallback": function ( settings ) {
        var api = this.api();
        var rows = api.rows( {page:'current'} ).nodes();
        var last=null;

        api.column(3, {page:'current'} ).data().each( function ( group, i ) {
          console.log("group:"+group);
          console.log("I -------> :"+i);
          if ( last !== group ) {
            $(rows).eq( i ).before(
                '<tr class="group"><td colspan="3" class="editable" id="'+ i + '" title="'+ group+ '"> '+ group+ '</td>' +
                '<td class="text-center"> <i class="fa fa-file-text add_files" aria-hidden="true"  id="'+ group+ '"></i>'+
                '</td></tr>'
            );

            last = group;
          }
        } );
      }
    });

    $('.document_list_master').change(function(){
      $('.document_list').prop('checked',$(this).prop("checked"));
    });

    $('.remove_document').click(function(){
      var ids = [];
      var tender_id = '<%= @tender.id %>';
      $("input:checkbox:checked").map(function()
      {
        ids.push($(this).val());
      })

      $.ajax({
        method: "POST",
        data: {ids:ids,tender_id:tender_id},
        url: "/addendas/delete_documents"
      }).done(function (data) {
        $('.addenda_table_list').html('');
        $('.addenda_table_list').html(data);
      });
    });

    $('.add_files').click(function(){
      $('.addenda_directory').val('');
      var directory = $(this).attr('id')
      $('.addenda_directory').val(directory);
      $('#add_file_Modal').modal('show');
    });

    /*$('.new_drop_zone').click(function(){
      $('.upload_file').click();

    });*/

    $('.move_document').click(function()
    {
      var ids = []
      $('.document_list').each(function()
      {
        if($(this).is(':checked')){
          ids.push($(this).val());
          $('#remove_file_Modal').modal('show');

        }

        $('.document_ids').val(ids);
      })
    });

    $('.move_documents').click(function(){
      var ids = $('.document_ids').val();
      var new_folder_name = $('.newly_folder').val();
      var directory = $('#directory').val();
      var tender_id = $('.tender_id').val();
      console.log(directory);

      console.log("IDS:"+ids);
      $.ajax({
        method: "POST",
        data: {ids:ids,new_folder_name:new_folder_name,directory:directory,tender_id:tender_id},
        url: "/addendas/move_files"
      }).done(function (data) {
        $('.addenda_table_list').html('');
        $('.addenda_table_list').html(data);
        $('#remove_file_Modal').modal('hide');

      });
    });


  });
</script>